<%- include('partials/header', { title: 'Control de Compras' }) %>

<%
  const totalSeguro =
    typeof totalGeneral !== 'undefined'
      ? totalGeneral
      : 0;
%>

<div class="container">

  <div class="page-head">
    <h1>ðŸ“¦ Control de Compras</h1>
    <a href="/compras/nueva" class="btn btn-primary">âž• Nueva compra</a>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid">
    <div class="kpi">
      <div class="kpi-label">Total (segÃºn filtros)</div>
      <div class="kpi-value">â‚¡ <%= Number(totalSeguro).toFixed(2) %></div>
    </div>
  </div>

  <!-- FILTROS -->
  <form method="GET" class="filters">
    <input type="text" name="placa" placeholder="Placa" value="<%= filtros.placa %>">
    <input type="text" name="proveedor" placeholder="Proveedor" value="<%= filtros.proveedor %>">
    <input type="text" name="cedis" placeholder="CEDIS" value="<%= filtros.cedis %>">
    <button class="btn">Filtrar</button>
    <a href="/compras" class="btn btn-light">Limpiar</a>
  </form>

  <!-- TABLA -->
  <table class="table">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>CEDIS</th>
        <th>Proveedor</th>
        <th>Placa</th>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>â‚¡ Unit</th>
        <th>â‚¡ Total</th>
        <th>SolicitÃ³</th>
      </tr>
    </thead>
    <tbody>
      <% if (compras.length === 0) { %>
        <tr>
          <td colspan="9" class="muted center">No hay registros</td>
        </tr>
      <% } %>

      <% compras.forEach(c => { %>
        <tr>
          <td><%= new Date(c.fecha).toLocaleDateString('es-CR') %></td>
          <td><%= c.cedis %></td>
          <td><%= c.proveedor %></td>
          <td><%= c.placa %></td>
          <td><%= c.producto %></td>
          <td class="right"><%= c.cantidad %></td>
          <td class="right">â‚¡ <%= Number(c.precio_unitario).toFixed(2) %></td>
          <td class="right bold">â‚¡ <%= Number(c.precio_total).toFixed(2) %></td>
          <td><%= c.solicito %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>

</div>

<%- include('partials/footer') %>
